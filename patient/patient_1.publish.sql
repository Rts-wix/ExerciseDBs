/*
Deployment script for Patient

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "Patient"
:setvar DefaultFilePrefix "Patient"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL12.SQLEXPRESS\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL12.SQLEXPRESS\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [master];


GO

IF (DB_ID(N'$(DatabaseName)') IS NOT NULL) 
BEGIN
    ALTER DATABASE [$(DatabaseName)]
    SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
    DROP DATABASE [$(DatabaseName)];
END

GO
PRINT N'Creating $(DatabaseName)...'
GO
CREATE DATABASE [$(DatabaseName)]
    ON 
    PRIMARY(NAME = [$(DatabaseName)], FILENAME = N'$(DefaultDataPath)$(DefaultFilePrefix)_Primary.mdf')
    LOG ON (NAME = [$(DatabaseName)_log], FILENAME = N'$(DefaultLogPath)$(DefaultFilePrefix)_Primary.ldf') COLLATE Danish_Norwegian_CI_AS
GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                NUMERIC_ROUNDABORT OFF,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON,
                CURSOR_DEFAULT LOCAL,
                RECOVERY FULL,
                CURSOR_CLOSE_ON_COMMIT OFF,
                AUTO_CREATE_STATISTICS ON,
                AUTO_SHRINK OFF,
                AUTO_UPDATE_STATISTICS ON,
                RECURSIVE_TRIGGERS OFF 
            WITH ROLLBACK IMMEDIATE;
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_CLOSE OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET READ_COMMITTED_SNAPSHOT OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_UPDATE_STATISTICS_ASYNC OFF,
                PAGE_VERIFY NONE,
                DATE_CORRELATION_OPTIMIZATION OFF,
                DISABLE_BROKER,
                PARAMETERIZATION SIMPLE,
                SUPPLEMENTAL_LOGGING OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET TRUSTWORTHY OFF,
        DB_CHAINING OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET HONOR_BROKER_PRIORITY OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET TARGET_RECOVERY_TIME = 0 SECONDS 
    WITH ROLLBACK IMMEDIATE;


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET FILESTREAM(NON_TRANSACTED_ACCESS = OFF),
                CONTAINMENT = NONE 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_CREATE_STATISTICS ON(INCREMENTAL = OFF),
                MEMORY_OPTIMIZED_ELEVATE_TO_SNAPSHOT = OFF,
                DELAYED_DURABILITY = DISABLED 
            WITH ROLLBACK IMMEDIATE;
    END


GO
USE [$(DatabaseName)];


GO
IF fulltextserviceproperty(N'IsFulltextInstalled') = 1
    EXECUTE sp_fulltext_database 'enable';


GO
PRINT N'Creating [dbo].[conducts]...';


GO
CREATE TABLE [dbo].[conducts] (
    [patientid]   INT            IDENTITY (1, 1) NOT NULL,
    [visitdate]   DATE           NOT NULL,
    [procedureid] CHAR (5)       NOT NULL,
    [physicianid] INT            NOT NULL,
    [charge]      NUMERIC (8, 2) NOT NULL,
    CONSTRAINT [PK__conducts__696483C9BC95AA2D] PRIMARY KEY CLUSTERED ([patientid] ASC, [visitdate] ASC, [procedureid] ASC)
);


GO
PRINT N'Creating [dbo].[insurance]...';


GO
CREATE TABLE [dbo].[insurance] (
    [cardholder] INT            NOT NULL,
    [company]    VARCHAR (50)   NOT NULL,
    [copay]      NUMERIC (5, 2) NULL,
    PRIMARY KEY CLUSTERED ([cardholder] ASC)
);


GO
PRINT N'Creating [dbo].[medicalprocedure]...';


GO
CREATE TABLE [dbo].[medicalprocedure] (
    [procedureid] CHAR (5)       NOT NULL,
    [name]        VARCHAR (30)   NOT NULL,
    [followup]    CHAR (5)       NULL,
    [risk]        CHAR (20)      NOT NULL,
    [price]       NUMERIC (5, 2) NULL,
    CONSTRAINT [PK__medicalp__8471DDB49004CDF4] PRIMARY KEY CLUSTERED ([procedureid] ASC)
);


GO
PRINT N'Creating [dbo].[patient]...';


GO
CREATE TABLE [dbo].[patient] (
    [patientid]        INT          IDENTITY (1, 1) NOT NULL,
    [firstname]        VARCHAR (30) NOT NULL,
    [lastname]         VARCHAR (30) NOT NULL,
    [gender]           CHAR (1)     NULL,
    [primaryphysician] INT          NULL,
    [birthday]         DATE         NULL,
    [insurance]        INT          NULL,
    CONSTRAINT [PK__patient__A17101B4ECC975A4] PRIMARY KEY CLUSTERED ([patientid] ASC)
);


GO
PRINT N'Creating [dbo].[physician]...';


GO
CREATE TABLE [dbo].[physician] (
    [physicianid] INT            IDENTITY (1, 1) NOT NULL,
    [name]        CHAR (30)      NOT NULL,
    [salary]      NUMERIC (8, 2) NULL,
    CONSTRAINT [PK__physicia__82B3610EBDD0231E] PRIMARY KEY CLUSTERED ([physicianid] ASC)
);


GO
PRINT N'Creating [dbo].[visits]...';


GO
CREATE TABLE [dbo].[visits] (
    [patientid]   INT  NOT NULL,
    [visitdate]   DATE NOT NULL,
    [physicianid] INT  NULL,
    PRIMARY KEY CLUSTERED ([patientid] ASC, [visitdate] ASC)
);


GO
PRINT N'Creating [dbo].[FK__conducts__physic__25869641]...';


GO
ALTER TABLE [dbo].[conducts]
    ADD CONSTRAINT [FK__conducts__physic__25869641] FOREIGN KEY ([physicianid]) REFERENCES [dbo].[physician] ([physicianid]);


GO
PRINT N'Creating [dbo].[FK__conducts__proced__267ABA7A]...';


GO
ALTER TABLE [dbo].[conducts]
    ADD CONSTRAINT [FK__conducts__proced__267ABA7A] FOREIGN KEY ([procedureid]) REFERENCES [dbo].[medicalprocedure] ([procedureid]);


GO
PRINT N'Creating [dbo].[FK__conducts_visits]...';


GO
ALTER TABLE [dbo].[conducts]
    ADD CONSTRAINT [FK__conducts_visits] FOREIGN KEY ([patientid], [visitdate]) REFERENCES [dbo].[visits] ([patientid], [visitdate]);


GO
PRINT N'Creating [dbo].[FK__insurance__cardh__182C9B23]...';


GO
ALTER TABLE [dbo].[insurance]
    ADD CONSTRAINT [FK__insurance__cardh__182C9B23] FOREIGN KEY ([cardholder]) REFERENCES [dbo].[patient] ([patientid]);


GO
PRINT N'Creating [dbo].[FK__medicalpr__follo__21B6055D]...';


GO
ALTER TABLE [dbo].[medicalprocedure]
    ADD CONSTRAINT [FK__medicalpr__follo__21B6055D] FOREIGN KEY ([followup]) REFERENCES [dbo].[medicalprocedure] ([procedureid]);


GO
PRINT N'Creating [dbo].[FK__patient__insuran__1920BF5C]...';


GO
ALTER TABLE [dbo].[patient]
    ADD CONSTRAINT [FK__patient__insuran__1920BF5C] FOREIGN KEY ([insurance]) REFERENCES [dbo].[insurance] ([cardholder]);


GO
PRINT N'Creating [dbo].[FK__patient__primary__145C0A3F]...';


GO
ALTER TABLE [dbo].[patient]
    ADD CONSTRAINT [FK__patient__primary__145C0A3F] FOREIGN KEY ([primaryphysician]) REFERENCES [dbo].[physician] ([physicianid]);


GO
PRINT N'Creating [dbo].[FK__visits__patienti__1BFD2C07]...';


GO
ALTER TABLE [dbo].[visits]
    ADD CONSTRAINT [FK__visits__patienti__1BFD2C07] FOREIGN KEY ([patientid]) REFERENCES [dbo].[patient] ([patientid]);


GO
PRINT N'Creating [dbo].[FK__visits__physicia__1CF15040]...';


GO
ALTER TABLE [dbo].[visits]
    ADD CONSTRAINT [FK__visits__physicia__1CF15040] FOREIGN KEY ([physicianid]) REFERENCES [dbo].[physician] ([physicianid]);


GO
PRINT N'Creating unnamed constraint on [dbo].[insurance]...';


GO
ALTER TABLE [dbo].[insurance]
    ADD CHECK ([copay]>=(0));


GO
PRINT N'Creating [dbo].[CK__medicalpr__price__20C1E124]...';


GO
ALTER TABLE [dbo].[medicalprocedure]
    ADD CONSTRAINT [CK__medicalpr__price__20C1E124] CHECK ([price]>=(0));


GO
PRINT N'Creating [dbo].[CK__medicalpro__risk__1FCDBCEB]...';


GO
ALTER TABLE [dbo].[medicalprocedure]
    ADD CONSTRAINT [CK__medicalpro__risk__1FCDBCEB] CHECK ([risk]='Certain Death' OR [risk]='High' OR [risk]='Moderate' OR [risk]='Minimal');


GO
PRINT N'Creating [dbo].[CK__patient__gender__1367E606]...';


GO
ALTER TABLE [dbo].[patient]
    ADD CONSTRAINT [CK__patient__gender__1367E606] CHECK ([gender]='F' OR [gender]='M');


GO
PRINT N'Creating [dbo].[CK__physician__salar__108B795B]...';


GO
ALTER TABLE [dbo].[physician]
    ADD CONSTRAINT [CK__physician__salar__108B795B] CHECK ([salary]>=(0));


GO
/*
This script was created by Visual Studio on 13-02-2015 at 01:11.
Run this script on SM-MBP\SQLEXPRESS.Patient (sm-MBP\sm) to make it the same as SM-MBP\SQLEXPRESS.patient_ (sm-MBP\sm).
This script performs its actions in the following order:
1. Disable foreign-key constraints.
2. Perform DELETE commands. 
3. Perform UPDATE commands.
4. Perform INSERT commands.
5. Re-enable foreign-key constraints.
Please back up your target database before running this script.
*/
SET NUMERIC_ROUNDABORT OFF
GO
SET XACT_ABORT, ANSI_PADDING, ANSI_WARNINGS, CONCAT_NULL_YIELDS_NULL, ARITHABORT, QUOTED_IDENTIFIER, ANSI_NULLS ON
GO
/*Pointer used for text / image updates. This might not be needed, but is declared here just in case*/
DECLARE @pv binary(16)
BEGIN TRANSACTION
ALTER TABLE [dbo].[medicalprocedure] DROP CONSTRAINT [FK__medicalpr__follo__21B6055D]
ALTER TABLE [dbo].[conducts] DROP CONSTRAINT [FK__conducts__physic__25869641]
ALTER TABLE [dbo].[conducts] DROP CONSTRAINT [FK__conducts__proced__267ABA7A]
ALTER TABLE [dbo].[conducts] DROP CONSTRAINT [FK__conducts_visits]
ALTER TABLE [dbo].[visits] DROP CONSTRAINT [FK__visits__patienti__1BFD2C07]
ALTER TABLE [dbo].[visits] DROP CONSTRAINT [FK__visits__physicia__1CF15040]
ALTER TABLE [dbo].[patient] DROP CONSTRAINT [FK__patient__insuran__1920BF5C]
ALTER TABLE [dbo].[patient] DROP CONSTRAINT [FK__patient__primary__145C0A3F]
ALTER TABLE [dbo].[insurance] DROP CONSTRAINT [FK__insurance__cardh__182C9B23]
INSERT INTO [dbo].[insurance] ([cardholder], [company], [copay]) VALUES (2, N'Nopay', 20.00)
INSERT INTO [dbo].[insurance] ([cardholder], [company], [copay]) VALUES (5, N'Till Death', 25.00)
INSERT INTO [dbo].[insurance] ([cardholder], [company], [copay]) VALUES (7, N'Exclaim Insurers', 15.00)
INSERT INTO [dbo].[insurance] ([cardholder], [company], [copay]) VALUES (9, N'Copay Surprise', NULL)
SET IDENTITY_INSERT [dbo].[patient] ON
INSERT INTO [dbo].[patient] ([patientid], [firstname], [lastname], [gender], [primaryphysician], [birthday], [insurance]) VALUES (1, N'Jane', N'Doe', N'F', 1, '19720823', 2)
INSERT INTO [dbo].[patient] ([patientid], [firstname], [lastname], [gender], [primaryphysician], [birthday], [insurance]) VALUES (2, N'Jack', N'Doe', N'M', 1, '19710224', 2)
INSERT INTO [dbo].[patient] ([patientid], [firstname], [lastname], [gender], [primaryphysician], [birthday], [insurance]) VALUES (3, N'Jack', N'Doe Jr.', N'M', 1, '19981113', 2)
INSERT INTO [dbo].[patient] ([patientid], [firstname], [lastname], [gender], [primaryphysician], [birthday], [insurance]) VALUES (4, N'Earl', N'Jackson', N'M', NULL, '19560101', NULL)
INSERT INTO [dbo].[patient] ([patientid], [firstname], [lastname], [gender], [primaryphysician], [birthday], [insurance]) VALUES (5, N'Fred', N'Smith', N'M', 3, NULL, 5)
INSERT INTO [dbo].[patient] ([patientid], [firstname], [lastname], [gender], [primaryphysician], [birthday], [insurance]) VALUES (6, N'Sara', N'Smith', N'F', 2, '19670809', 5)
INSERT INTO [dbo].[patient] ([patientid], [firstname], [lastname], [gender], [primaryphysician], [birthday], [insurance]) VALUES (7, N'Pat', N'Rosenberg', NULL, 3, '19700517', 7)
INSERT INTO [dbo].[patient] ([patientid], [firstname], [lastname], [gender], [primaryphysician], [birthday], [insurance]) VALUES (8, N'George', N'Jones', N'M', 3, '19651123', 9)
INSERT INTO [dbo].[patient] ([patientid], [firstname], [lastname], [gender], [primaryphysician], [birthday], [insurance]) VALUES (9, N'Melissa ', N'Franklin', N'F', 3, '19620517', 9)
SET IDENTITY_INSERT [dbo].[patient] OFF
INSERT INTO [dbo].[visits] ([patientid], [visitdate], [physicianid]) VALUES (2, '20041215', 1)
INSERT INTO [dbo].[visits] ([patientid], [visitdate], [physicianid]) VALUES (2, '20050119', 3)
INSERT INTO [dbo].[visits] ([patientid], [visitdate], [physicianid]) VALUES (3, '20050405', 1)
INSERT INTO [dbo].[visits] ([patientid], [visitdate], [physicianid]) VALUES (3, '20050426', NULL)
INSERT INTO [dbo].[visits] ([patientid], [visitdate], [physicianid]) VALUES (3, '20050802', 2)
INSERT INTO [dbo].[visits] ([patientid], [visitdate], [physicianid]) VALUES (4, '20040329', 2)
INSERT INTO [dbo].[visits] ([patientid], [visitdate], [physicianid]) VALUES (4, '20050118', NULL)
INSERT INTO [dbo].[visits] ([patientid], [visitdate], [physicianid]) VALUES (5, '20041125', 3)
INSERT INTO [dbo].[visits] ([patientid], [visitdate], [physicianid]) VALUES (5, '20051125', 2)
INSERT INTO [dbo].[visits] ([patientid], [visitdate], [physicianid]) VALUES (7, '20041012', 3)
INSERT INTO [dbo].[visits] ([patientid], [visitdate], [physicianid]) VALUES (7, '20041115', 2)
INSERT INTO [dbo].[visits] ([patientid], [visitdate], [physicianid]) VALUES (7, '20050302', 3)
INSERT INTO [dbo].[visits] ([patientid], [visitdate], [physicianid]) VALUES (7, '20050627', 1)
INSERT INTO [dbo].[visits] ([patientid], [visitdate], [physicianid]) VALUES (8, '20050102', 2)
SET IDENTITY_INSERT [dbo].[physician] ON
INSERT INTO [dbo].[physician] ([physicianid], [name], [salary]) VALUES (1, N'Edward Scalpelhands           ', 100000.00)
INSERT INTO [dbo].[physician] ([physicianid], [name], [salary]) VALUES (2, N'Ann Ethesiologist             ', 134000.00)
INSERT INTO [dbo].[physician] ([physicianid], [name], [salary]) VALUES (3, N'Jane Doe                      ', NULL)
INSERT INTO [dbo].[physician] ([physicianid], [name], [salary]) VALUES (4, N'Neal Natology                 ', 167000.00)
SET IDENTITY_INSERT [dbo].[physician] OFF
SET IDENTITY_INSERT [dbo].[conducts] ON
INSERT INTO [dbo].[conducts] ([patientid], [visitdate], [procedureid], [physicianid], [charge]) VALUES (2, '20041215', N'DRUGS', 1, 10.00)
INSERT INTO [dbo].[conducts] ([patientid], [visitdate], [procedureid], [physicianid], [charge]) VALUES (3, '20050405', N'DRUGS', 1, 12.00)
INSERT INTO [dbo].[conducts] ([patientid], [visitdate], [procedureid], [physicianid], [charge]) VALUES (3, '20050405', N'STICH', 1, 45.00)
INSERT INTO [dbo].[conducts] ([patientid], [visitdate], [procedureid], [physicianid], [charge]) VALUES (3, '20050426', N'RMSTC', 3, 60.00)
INSERT INTO [dbo].[conducts] ([patientid], [visitdate], [procedureid], [physicianid], [charge]) VALUES (4, '20050118', N'RMSTC', 2, 110.00)
INSERT INTO [dbo].[conducts] ([patientid], [visitdate], [procedureid], [physicianid], [charge]) VALUES (5, '20041125', N'STICH', 3, 50.00)
INSERT INTO [dbo].[conducts] ([patientid], [visitdate], [procedureid], [physicianid], [charge]) VALUES (7, '20041012', N'DRUGS', 4, 12.00)
SET IDENTITY_INSERT [dbo].[conducts] OFF
INSERT INTO [dbo].[medicalprocedure] ([procedureid], [name], [followup], [risk], [price]) VALUES (N'BNDAD', N'Bandage', NULL, N'Minimal             ', 25.00)
INSERT INTO [dbo].[medicalprocedure] ([procedureid], [name], [followup], [risk], [price]) VALUES (N'DRUGS', N'Medicate', NULL, N'High                ', 15.00)
INSERT INTO [dbo].[medicalprocedure] ([procedureid], [name], [followup], [risk], [price]) VALUES (N'RDPBF', N'Reduce % Body Fat for $', NULL, N'Certain Death       ', NULL)
INSERT INTO [dbo].[medicalprocedure] ([procedureid], [name], [followup], [risk], [price]) VALUES (N'RMSTC', N'Remove Stitches', NULL, N'Moderate            ', 100.00)
INSERT INTO [dbo].[medicalprocedure] ([procedureid], [name], [followup], [risk], [price]) VALUES (N'STICH', N'Stitch', N'RMSTC', N'Moderate            ', 50.00)
ALTER TABLE [dbo].[medicalprocedure]
    ADD CONSTRAINT [FK__medicalpr__follo__21B6055D] FOREIGN KEY ([followup]) REFERENCES [dbo].[medicalprocedure] ([procedureid])
ALTER TABLE [dbo].[conducts]
    ADD CONSTRAINT [FK__conducts__physic__25869641] FOREIGN KEY ([physicianid]) REFERENCES [dbo].[physician] ([physicianid])
ALTER TABLE [dbo].[conducts]
    ADD CONSTRAINT [FK__conducts__proced__267ABA7A] FOREIGN KEY ([procedureid]) REFERENCES [dbo].[medicalprocedure] ([procedureid])
ALTER TABLE [dbo].[conducts]
    ADD CONSTRAINT [FK__conducts_visits] FOREIGN KEY ([patientid], [visitdate]) REFERENCES [dbo].[visits] ([patientid], [visitdate])
ALTER TABLE [dbo].[visits]
    ADD CONSTRAINT [FK__visits__patienti__1BFD2C07] FOREIGN KEY ([patientid]) REFERENCES [dbo].[patient] ([patientid])
ALTER TABLE [dbo].[visits]
    ADD CONSTRAINT [FK__visits__physicia__1CF15040] FOREIGN KEY ([physicianid]) REFERENCES [dbo].[physician] ([physicianid])
ALTER TABLE [dbo].[patient]
    ADD CONSTRAINT [FK__patient__insuran__1920BF5C] FOREIGN KEY ([insurance]) REFERENCES [dbo].[insurance] ([cardholder])
ALTER TABLE [dbo].[patient]
    ADD CONSTRAINT [FK__patient__primary__145C0A3F] FOREIGN KEY ([primaryphysician]) REFERENCES [dbo].[physician] ([physicianid])
ALTER TABLE [dbo].[insurance]
    ADD CONSTRAINT [FK__insurance__cardh__182C9B23] FOREIGN KEY ([cardholder]) REFERENCES [dbo].[patient] ([patientid])
COMMIT TRANSACTION
GO

GO
DECLARE @VarDecimalSupported AS BIT;

SELECT @VarDecimalSupported = 0;

IF ((ServerProperty(N'EngineEdition') = 3)
    AND (((@@microsoftversion / power(2, 24) = 9)
          AND (@@microsoftversion & 0xffff >= 3024))
         OR ((@@microsoftversion / power(2, 24) = 10)
             AND (@@microsoftversion & 0xffff >= 1600))))
    SELECT @VarDecimalSupported = 1;

IF (@VarDecimalSupported > 0)
    BEGIN
        EXECUTE sp_db_vardecimal_storage_format N'$(DatabaseName)', 'ON';
    END


GO
PRINT N'Update complete.';


GO
